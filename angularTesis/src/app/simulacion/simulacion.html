<div class="simulacion-container">
  <section class="titulo-simulacion">
    <h1>Simulación de Escenarios Académicos</h1>
    <p>Proyecta tu próximo semestre con base en tus avances, pendientes y preferencias. Esta simulación te sugiere las
      materias ideales según tu situación académica, ayudándote a planificar mejor tu carga y avanzar de forma óptima.
      Ahorra tiempo, evita errores de inscripción y planifica tu semestre con datos reales.</p>
  </section>

  <section class="preferencias-academicas">
    <h2>Preferencias Académicas</h2>
    <form class="form-vertical">
      <div class="form-group">
        <label for="semestreInput">Cantidad de Semestres a Proyectar</label>
        <input type="number" id="semestreInput" name="semestreInput" [(ngModel)]="semestreInput" />
      </div>

      <div class="form-group">
        <label for="tipoMatricula">Tipo de Matrícula</label>
        <select id="tipoMatricula" name="tipoMatricula" [(ngModel)]="tipoMatricula" (change)="ajustarCreditos()">
          <option value="Media Matrícula">Media Matrícula</option>
          <option value="Matrícula completa">Matrícula completa</option>
          <option value="Matrícula completa + 1 créditos">Matrícula completa + 1 créditos</option>
          <option value="Matrícula completa + 2 créditos">Matrícula completa + 2 créditos</option>
          <option value="Matrícula completa + 3 créditos">Matrícula completa + 3 créditos</option>
          <option value="Matrícula completa + 4 créditos">Matrícula completa + 4 créditos</option>
        </select>
      </div>

      <div class="form-group">
        <label for="creditosInput">Cantidad de Créditos a Inscribir</label>
        <input type="number" id="creditosInput" name="creditosInput" [(ngModel)]="creditosInput"
          [attr.max]="maxCreditos" (input)="ajustarCreditos()" />
        <small style="color: gray;">Máximo según tipo de matrícula: {{ maxCreditos }}</small>
      </div>

      <div class="form-group">
        <label for="materiasInput">Cantidad de Materias a Inscribir</label>
        <input type="number" id="materiasInput" name="materiasInput" [(ngModel)]="materiasInput" />
      </div>
    </form>
  </section>

  <hr class="section-divider" />

  <section class="priorizacion-materias">
    <h2>Priorización de Materias</h2>
    <p>Selecciona las materias prioritarias para futuros semestres. Elije máximo {{ maxSelecciones }} campos para mejorar la predicción en la simulación.</p>
    <p><small style="color: gray;">Campos seleccionados: {{ seleccionesActuales }}/{{ maxSelecciones }}</small></p>
    
    <!-- Mensaje de error -->
    <p *ngIf="mostrarMensajeError" class="mensaje-error">
      ⚠️ No puedes seleccionar más de {{ maxSelecciones }} campos de priorización.
    </p>
    
    <div class="checkbox-group">
      <div>
        <input 
          type="checkbox" 
          id="prioridad-nucleo-basicas"
          [checked]="priorizacionMaterias.nucleoCienciasBasicas"
          (change)="onCheckboxChange('nucleoCienciasBasicas', $event)" 
        /> 
        <label for="prioridad-nucleo-basicas">
          Núcleo de Ciencias Básicas (ej. Cálculos, Físicas, Químicas)
        </label>
      </div>

      <div>
        <input 
          type="checkbox" 
          id="prioridad-nucleo-aplicada"
          [checked]="priorizacionMaterias.nucleoIngenieriaAplicada"
          (change)="onCheckboxChange('nucleoIngenieriaAplicada', $event)" 
        /> 
        <label for="prioridad-nucleo-aplicada">
          Núcleo de Ingeniería Aplicada (Específicas de la carrera)
        </label>
      </div>

      <div>
        <input 
          type="checkbox" 
          id="prioridad-socio-humanistica"
          [checked]="priorizacionMaterias.nucleoSocioHumanistica"
          (change)="onCheckboxChange('nucleoSocioHumanistica', $event)" 
        /> 
        <label for="prioridad-socio-humanistica">
          Núcleo Socio-humanística (ej. Teologías, Éticas)
        </label>
      </div>

      <div>
        <input 
          type="checkbox" 
          id="prioridad-electivas"
          [checked]="priorizacionMaterias.electivas"
          (change)="onCheckboxChange('electivas', $event)" 
        /> 
        <label for="prioridad-electivas">
          Electivas
        </label>
      </div>

      <div>
        <input 
          type="checkbox" 
          id="prioridad-complementarias"
          [checked]="priorizacionMaterias.complementarias"
          (change)="onCheckboxChange('complementarias', $event)" 
        /> 
        <label for="prioridad-complementarias">
          Complementarias
        </label>
      </div>

      <div>
        <input 
          type="checkbox" 
          id="prioridad-enfasis"
          [checked]="priorizacionMaterias.enfasis"
          (change)="onCheckboxChange('enfasis', $event)" 
        /> 
        <label for="prioridad-enfasis">
          Énfasis
        </label>
      </div>
    </div>
  </section>

  <button class="simulacion-button" (click)="generarSimulacion()">Generar Simulación</button>
</div>


<div *ngIf="resultadoSimulacion">
  <div *ngFor="let semestre of resultadoSimulacion | keyvalue">
    <h2>Semestre {{ semestre.key }}</h2>
    <ul *ngIf="semestre.value.materias">
      <li *ngFor="let materia of semestre.value.materias">
        <strong>{{ materia.nombre }}</strong> (Código: {{ materia.codigo }})<br />
        Créditos: {{ materia.creditos }}<br />
        Requisitos:
        <ul>
          <li *ngFor="let req of materia.requisitos">{{ req }}</li>
        </ul>
      </li>
    </ul>
  </div>
</div>