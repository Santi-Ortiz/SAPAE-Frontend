<div class="simulacion-container">
  <section class="titulo-simulacion">
    <h1>Simulación de Escenarios Académicos</h1>
    <p>Proyecta tu próximo semestre con base en tus avances, pendientes y preferencias. Esta simulación te sugiere las
      materias ideales según tu situación académica, ayudándote a planificar mejor tu carga y avanzar de forma óptima.
      Ahorra tiempo, evita errores de inscripción y planifica tu semestre con datos reales.</p>
    
    <!-- Información sobre el nuevo proceso -->
    <div class="info-proceso-asincrono">
      <h3>¿Cómo funciona la simulación?</h3>
      <ul class="lista-viñetas">
        <li>Las simulaciones se procesan en segundo plano</li>
        <li>Puedes navegar libremente mientras se calcula tu simulación</li>
        <li>Recibirás una notificación cuando esté lista</li>
      </ul>
    </div>
      <button class="historial-button" (click)="verHistorialSimulaciones()">Ver Historial de Simulaciones</button>
  </section>

  <section class="preferencias-academicas">
    <h2>Nombre de la Simulación</h2>
    <div class="form-group">
      <label for="nombreSimulacion">Ingresa un nombre para la simulación</label>
      <input type="text" id="nombreSimulacion" name="nombreSimulacion" [(ngModel)]="nombreSimulacion" 
             placeholder="Ej: Mi simulación semestre 2025-2" maxlength="50" 
             (input)="validarNombreSimulacion()" />
      <small style="color: gray;" *ngIf="!nombreDuplicado">Este nombre servirá para identificar cada simulación que realice</small>
      <small style="color: #0077b6;" *ngIf="nombreDuplicado"><strong>Ya tienes una simulación guardada con este nombre. Por favor, elige otro nombre.</strong></small>
    </div>
  </section>

  <section class="preferencias-academicas">
    <h2>Preferencias Académicas</h2>
    <p>Configura cómo quieres simular tu avance académico seleccionando cuántos semestres proyectarás, el tipo de matrícula, los límites de créditos y materias por semestre.</p>
    <form>
      <div class="form-grid">
        <div class="form-block">
          <div class="form-block-subtitle">Configuración General</div>

          <div class="form-group">
            <label for="semestreInput">Cantidad de Semestres a Simular</label>
            <input type="number" id="semestreInput" name="semestreInput" [(ngModel)]="semestreInput" min="1" />
            <small style="color: gray;">Se simularán {{ semestreInput }} semestres hacia adelante</small>
          </div>
        
          <div class="form-group">
            <label for="tipoMatricula">Tipo de Matrícula</label>
            <select id="tipoMatricula" name="tipoMatricula" [(ngModel)]="tipoMatricula" (change)="ajustarCreditos()">
              <option value="Media Matrícula">Media Matrícula</option>
              <option value="Matrícula completa">Matrícula completa</option>
              <option value="Matrícula completa + 1 crédito">Matrícula completa + 1C</option>
              <option value="Matrícula completa + 2 créditos">Matrícula completa + 2C</option>
              <option value="Matrícula completa + 3 créditos">Matrícula completa + 3C</option>
              <option value="Matrícula completa + 4 créditos">Matrícula completa + 4C</option>
            </select>
            <small style="color: gray;">Se asignará: {{ tipoMatricula }}</small>
          </div>

        </div>

        <div class="form-block">
          <div class="form-block-subtitle">Configuración por Semestre</div>
          <div class="form-group">
            <label for="creditosInput">Cantidad Máxima de Créditos a Inscribir</label>
            <input type="number" id="creditosInput" name="creditosInput" [(ngModel)]="creditosInput"
              [attr.max]="maxCreditos" (input)="ajustarCreditos()" min="1" />
            <small style="color: gray;">Máximo según tipo de matrícula: {{ maxCreditos }} créditos</small>
          </div>

          <div class="form-group">
            <label for="materiasInput">Cantidad Máxima de Materias a Inscribir</label>
            <input type="number" id="materiasInput" name="materiasInput" [(ngModel)]="materiasInput" [attr.max]="maxMaterias" (input)="ajustarMaterias()" min="1" />
            <small style="color: gray;">Límite máximo: {{ maxMaterias }} materias</small>
          </div>
        </div>
      </div>
    </form>
  </section>

  <hr class="section-divider" />

  <section class="priorizacion-materias">
    <h2>Priorización de Materias</h2>
    <p>Selecciona las materias prioritarias para futuros semestres. Elije máximo {{ maxSelecciones }} campos para mejorar la predicción en la simulación.</p>
    <p><small style="color: gray;">Campos seleccionados: {{ seleccionesActuales }}/{{ maxSelecciones }}</small></p>
    
    <!-- Mensaje de error -->
    <p *ngIf="mostrarMensajeError" class="mensaje-error">
      Alcanzaste el máximo de selecciones para priorización de materias
    </p>
    
    <div class="checkbox-group">
      <div>
        <input 
          type="checkbox" 
          id="prioridad-nucleo-basicas"
          [checked]="priorizacionMaterias.nucleoCienciasBasicas"
          (change)="onCheckboxChange('nucleoCienciasBasicas', $event)"
          [disabled]="!priorizacionMaterias.nucleoCienciasBasicas && seleccionesActuales >= maxSelecciones" 
        /> 
        <label for="prioridad-nucleo-basicas">
          Núcleo de Ciencias Básicas (ej. Cálculos, Físicas, Químicas)
        </label>
      </div>

      <div>
        <input 
          type="checkbox" 
          id="prioridad-nucleo-aplicada"
          [checked]="priorizacionMaterias.nucleoIngenieriaAplicada"
          (change)="onCheckboxChange('nucleoIngenieriaAplicada', $event)"
          [disabled]="!priorizacionMaterias.nucleoIngenieriaAplicada && seleccionesActuales >= maxSelecciones" 
        /> 
        <label for="prioridad-nucleo-aplicada">
          Núcleo de Ingeniería Aplicada (Específicas de la carrera)
        </label>
      </div>

      <div>
        <input 
          type="checkbox" 
          id="prioridad-socio-humanistica"
          [checked]="priorizacionMaterias.nucleoSocioHumanistica"
          (change)="onCheckboxChange('nucleoSocioHumanistica', $event)"
          [disabled]="!priorizacionMaterias.nucleoSocioHumanistica && seleccionesActuales >= maxSelecciones" 
        /> 
        <label for="prioridad-socio-humanistica">
          Núcleo Socio-humanística (ej. Teologías, Éticas)
        </label>
      </div>

      <div>
        <input 
          type="checkbox" 
          id="prioridad-electivas"
          [checked]="priorizacionMaterias.electivas"
          (change)="onCheckboxChange('electivas', $event)"
          [disabled]="!priorizacionMaterias.electivas && seleccionesActuales >= maxSelecciones" 
        /> 
        <label for="prioridad-electivas">
          Electivas
        </label>
      </div>

      <div>
        <input 
          type="checkbox" 
          id="prioridad-complementarias"
          [checked]="priorizacionMaterias.complementarias"
          (change)="onCheckboxChange('complementarias', $event)"
          [disabled]="!priorizacionMaterias.complementarias && seleccionesActuales >= maxSelecciones" 
        /> 
        <label for="prioridad-complementarias">
          Complementarias
        </label>
      </div>

      <div>
        <input 
          type="checkbox" 
          id="prioridad-enfasis"
          [checked]="priorizacionMaterias.enfasis"
          (change)="onCheckboxChange('enfasis', $event)"
          [disabled]="!priorizacionMaterias.enfasis && seleccionesActuales >= maxSelecciones" 
        /> 
        <label for="prioridad-enfasis">
          Énfasis
        </label>
      </div>
    </div>
  </section>

  <button class="simulacion-button" (click)="generarSimulacion()">Generar Simulación</button>

  <div class="modal-backdrop" *ngIf="camposIncompletos">
    <div class="modal-custom">
      <h3>Campos incompletos</h3>
      <p>Completa todos los campos de 'Nombre de Simulación' y 'Preferencias Académicas' antes de generar la simulación</p>
      <button (click)="camposIncompletos = false">Cerrar</button>
    </div>
  </div>

  <div class="modal-backdrop" *ngIf="nombreDuplicadoModal">
    <div class="modal-custom">
      <h3>Nombre duplicado</h3>
      <p>Ya tienes una simulación guardada con el nombre "{{ nombreSimulacion }}". Por favor, elige un nombre diferente para continuar.</p>
      <button (click)="nombreDuplicadoModal = false">Cerrar</button>
    </div>
  </div>
  
</div>