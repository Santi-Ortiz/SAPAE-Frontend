<h1 id="historial">Historial de Cursos</h1>
<p class="description">
  Selecciona tu informe de avance en formato PDF y haz clic en “Cargar PDF” para visualizar el historial de cursos registrados en el informe de avance a lo largo de tu programa académico.
</p>

<form (ngSubmit)="onSubmit()" enctype="multipart/form-data">
    <input type="file" (change)="onFileSelected($event)" accept="application/pdf" required />
  <button type="submit">Cargar PDF</button>
</form>

<p *ngIf="error" class="error">{{ error }}</p>

<!-- Tabla General de Materias -->
<table *ngIf="materias?.length">
  <thead>
    <tr>
      <th>Ciclo</th>
      <th>Materia</th>
      <th>N° Cat</th>
      <th>Curso</th>
      <th>Título</th>
      <th>Calif</th>
      <th>Cred</th>
      <th>Tipo</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let m of materias">
      <td>{{ m.cicloLectivo }}</td>
      <td>{{ m.materia }}</td>
      <td>{{ m.numeroCat }}</td>
      <td>{{ m.curso }}</td>
      <td>{{ m.titulo }}</td>
      <td [ngClass]="{'sin-calificacion': m.calif === 'SIN CALIFICACIÓN'}">
        {{ m.calif === 'SIN CALIFICACIÓN' ? '⚠️' : m.calif }}
      </td>
      <td>{{ m.cred }}</td>
      <td>{{ m.tipo }}</td>
    </tr>
  </tbody>
</table>

<p *ngIf="materias?.length" class="nota">
  <span class="warning">⚠️</span> Indica que la asignatura aún no tiene calificación registrada.
</p>

<!-- Reutilizable para cursos -->
<ng-container *ngFor="let bloque of bloques">
  <div *ngIf="bloque.lista?.length">
    <h2>{{ bloque.titulo }}</h2>
    <table>
      <thead>
        <tr>
          <th>Ciclo</th>
          <th>Materia</th>
          <th>N° Cat</th>
          <th>Curso</th>
          <th>Título</th>
          <th>Calif</th>
          <th>Cred</th>
          <th>Tipo</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let m of bloque.lista">
          <td>{{ m.cicloLectivo }}</td>
          <td>{{ m.materia }}</td>
          <td>{{ m.numeroCat }}</td>
          <td>{{ m.curso }}</td>
          <td>{{ m.titulo }}</td>
          <td>{{ m.calif }}</td>
          <td>{{ m.cred }}</td>
          <td>{{ m.tipo }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</ng-container>

<!-- Progreso -->
<div *ngIf="promedio">
  <h3>Progreso de la carrera</h3>
  <div class="progress-container">
    <div class="progress-bar" [style.width.%]="porcentaje">
      <span>{{ porcentaje.toFixed(2) }}%</span>
    </div>
  </div>

  <h2>Promedio: {{ promedio.toFixed(2) }}</h2>
  <p>
    <b>Materias cursadas:</b> {{ materiasCursadas }}<br />
    <b>Materias que se están cursando:</b> {{ materiasCursando }}<br />
    <b>Materias faltantes:</b> {{ materiasFaltantes }}
  </p>

  <div>
    <h3>Créditos faltantes por tipo:</h3>
    <ul>
      <li><b>Electivas:</b> {{ faltanElectiva }} créditos</li>
      <li><b>Complementarias:</b> {{ faltanComplementaria }} créditos</li>
      <li><b>Énfasis:</b> {{ faltanEnfasis }} créditos</li>
      <li><b>Electiva de Ciencias Básicas:</b> {{ faltanElectivaBasicas }} créditos</li>
    </ul>
  </div>

  <div *ngIf="listaMateriasFaltantes?.length">
    <h3>Materias que te faltan:</h3>
    <ul>
        <li *ngFor="let mat of listaMateriasFaltantes">
            {{ mat }}
        </li>          
    </ul>
  </div>
</div>

<!-- Requisitos de Grado -->
<div *ngIf="lineasRequisitosGrado?.length">
  <h2>Requisitos de Grado</h2>
  <p>{{ lineasRequisitosGrado[0] }}</p>
  <ul>
    <li *ngFor="let linea of lineasRequisitosGrado.slice(1)">
      {{ linea.replace(' / ', ' ➔ ') }}
    </li>
  </ul>
</div>
